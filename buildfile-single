# TODO:
# * Hur skapar man en katalog typ buildrJars?
#
	
# Generated by Buildr 1.4.4, change to your liking
# Version number for this release
VERSION_NUMBER = "1.0.0"
# Group identifier for your projects
GROUP = "Avega"
COPYRIGHT = "Mikael Amborn"

# Specify Maven 2.0 remote repositories here, like this:
repositories.remote << "http://www.ibiblio.org/maven2/"

bank_layout = Layout.new
bank_layout[:source, :main, :java] = 'src'
bank_layout[:source, :main, :resources] = "dd/ejb"
bank_layout[:source, :main, :webapp] = "web"

#bank_web_layout = Layout.new
#bank_web_layout

desc "The Duke Bank sample ejb project"
define "bank_ejb", :layout => bank_layout do

  project.version = VERSION_NUMBER
  project.group = GROUP
  manifest["Implementation-Vendor"] = COPYRIGHT
  
  compile.with Dir[_("lib/*.jar")]
  bank_ejb = package(:jar, :file => 'buildrJars/bank-ejb.jar').clean
  bank_ejb.path('com/sun/ebank').tap do |path|
	path.include path_to(:target, :main, :classes, 'com/sun/ebank/util')
	path.include path_to(:target, :main, :classes, 'com/sun/ebank/ejb')
  end
  bank_ejb.include(path_to(:target, :main, :resources), :as=>'META-INF')
  
  check bank_ejb, 'should contain ejb-jar.xml in META-INF' do
	it.should contain('META-INF/ejb-jar.xml')
  end
  
  # web_client = package(:war, :file => 'buildrJars/web-client.war')
  # puts web_client.classes
  # web_client.exclude('WEB-INF/classes/com/sun/ebank/appclient') 
  # web_client.exclude('WEB-INF/classes/com/sun/ebank/ejb')
  # web_client.exclude('WEB-INF/classes/com/sun/ebank/util')   
  # web_client.exclude('WEB-INF/classes/client')
  # web_client.exclude('WEB-INF/classes/ejb')
  # web_client.exclude('WEB-INF/classes/ws')
  # web_client.resources
  
  # web_client.classes.clear
  # web_client.include(path_to(:target, :main, :classes, 'com/sun/ebank/web'), :path=>'com/sun/ebank'
  #web_client.include(path_to(:target, :main, :classes, 'com/jboss/ebank'), :as=>'com/jboss')
  # web_client.include(path_to(:target, :main, :reso 
   
  #package(:ear).clean
  #package :ear, :file => 'buildrJars/JBossDukesBank.ear'
  
  #package(:jar).clean #.include(path_to())
  #package :jar, :file => 'buildrJars/app-client.jar'
  
  #package { directory _('buildrJars') }
  
  clean { rm_rf _('buildrJars/bank-ejb.jar') }
end

bank_web_layout = Layout.new
bank_web_layout[:source, :main, :java] = 'src'
bank_web_layout[:source, :main, :resources] = "dd/web"
bank_web_layout[:source, :main, :webapp] = "web"

define "bank_web", :layout=>bank_web_layout do

  web_client = package(:war, :file => 'buildrJars/web-client.war')
  web_client.exclude('WEB-INF/classes/com/sun/ebank/appclient') 
  web_client.exclude('WEB-INF/classes/com/sun/ebank/ejb')
  web_client.exclude('WEB-INF/classes/com/sun/ebank/util')   
  
  clean { rm_rf _('buildrJars/bank-web.jar') }
end
